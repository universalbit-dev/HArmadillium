name: Build & Configure HA Cluster

on:
  workflow_dispatch:   # Allows manual trigger via Actions tab
  push:
    branches:
      - main

jobs:
  ha_cluster_setup:
    runs-on: ubuntu-latest

    env:
      STATIC_IP: "192.168.1.100"         # Set your desired static IP
      SUBNET_MASK: "255.255.255.0"       # Set your desired subnet mask
      GATEWAY: "192.168.1.1"             # Set your desired gateway address
      DNS_SERVERS: "8.8.8.8,8.8.4.4"     # Set your desired DNS servers

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Make HA cluster setup script executable
        run: chmod +x ha_cluster_setup.sh

      - name: Run HA cluster setup (non-interactive)
        run: sudo ./ha_cluster_setup.sh

      - name: Show service status
        run: |
          sudo systemctl status nginx || true
          sudo systemctl status apache2 || true
          sudo systemctl status haproxy || true
          sudo systemctl status fail2ban || true
